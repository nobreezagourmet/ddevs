<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Cria√ß√£o de Rifa</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, button { padding: 10px; margin: 5px 0; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üß™ TESTE DE CRIA√á√ÉO DE RIFA</h1>
    
    <div class="form-group">
        <label>Token de Admin:</label>
        <input type="text" id="adminToken" placeholder="Cole o token JWT aqui" style="width: 400px;">
    </div>
    
    <div class="form-group">
        <label>T√≠tulo da Rifa:</label>
        <input type="text" id="title" value="Rifa de Teste Autom√°tico">
    </div>
    
    <div class="form-group">
        <label>Pre√ßo por Cota:</label>
        <input type="number" id="price" value="10.50" step="0.01" min="0.01">
    </div>
    
    <div class="form-group">
        <label>Total de Cotas:</label>
        <input type="number" id="quotas" value="100" min="1" max="100000">
    </div>
    
    <div class="form-group">
        <label>Imagem (opcional):</label>
        <input type="file" id="image" accept="image/*">
    </div>
    
    <button onclick="testCreateRaffle()">üöÄ TESTAR CRIA√á√ÉO DE RIFA</button>
    <button onclick="clearLogs()">üßπ LIMPAR LOGS</button>
    
    <div id="status"></div>
    <div id="logs"></div>

    <script>
        const API_URL = 'https://ddevs-86w2.onrender.com';
        
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function addLog(message) {
            const logsDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        }
        
        async function testCreateRaffle() {
            const token = document.getElementById('adminToken').value;
            const title = document.getElementById('title').value;
            const price = document.getElementById('price').value;
            const quotas = document.getElementById('quotas').value;
            const imageFile = document.getElementById('image').files[0];
            
            if (!token) {
                showStatus('‚ùå Token de admin √© obrigat√≥rio', 'error');
                return;
            }
            
            if (!title || !price || !quotas) {
                showStatus('‚ùå Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }
            
            showStatus('üîÑ Enviando requisi√ß√£o...', 'info');
            addLog(`Iniciando teste: ${title}, R$${price}, ${quotas} cotas`);
            
            try {
                const formData = new FormData();
                formData.append('title', title);
                formData.append('pricePerQuota', price);
                formData.append('totalQuotas', quotas);
                formData.append('quickSelectPackages', JSON.stringify([10, 25, 50]));
                
                if (imageFile) {
                    formData.append('image', imageFile);
                    addLog(`Imagem adicionada: ${imageFile.name}`);
                }
                
                addLog('Enviando FormData para API...');
                
                const response = await fetch(`${API_URL}/api/admin/create-raffle`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                addLog(`Status da resposta: ${response.status} ${response.statusText}`);
                
                const data = await response.json();
                addLog(`Resposta JSON: ${JSON.stringify(data, null, 2)}`);
                
                if (response.ok && data.success) {
                    showStatus(`‚úÖ SUCESSO! Rifa criada: ${data.message}`, 'success');
                    addLog(`ID da rifa: ${data.data._id}`);
                    addLog(`URL da imagem: ${data.data.imageUrl || 'Sem imagem'}`);
                } else {
                    showStatus(`‚ùå ERRO: ${data.message}`, 'error');
                    addLog(`Erro detalhado: ${JSON.stringify(data, null, 2)}`);
                }
                
            } catch (error) {
                showStatus(`‚ùå ERRO DE CONEX√ÉO: ${error.message}`, 'error');
                addLog(`Erro completo: ${error.stack}`);
            }
        }
        
        // Carregar token do localStorage se existir
        window.onload = function() {
            const savedToken = localStorage.getItem('adminToken');
            if (savedToken) {
                document.getElementById('adminToken').value = savedToken;
                addLog('Token carregado do localStorage');
            }
        };
    </script>
</body>
</html>
